<html>
    <head>
        <title>STudent Result Management System</title>
        <script src="./static/React/axios.min.js"></script>
        <link rel='stylesheet' type="text/css" href="./static/CSS/login.css"></link>
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <script>
            //if(window.location.pathname != '/home')
              //  window.open('/home','_self');
        </script>
        <style>
            body{
                min-width: 80rem;
                object-position: center;
                font-family: Arial, Helvetica, sans-serif;
                text-align: center;
                width: 100%;
                display: block;
                box-sizing: border-box;
                margin: -10px -10px 0px 0px;
            }    
        </style>
    </head>
    <body>
        <div id='home-page'>
            <div class='login-page'>
                <form id='main-form'>
                    <h2>BIT</h2>
                    <p id='authenticationError'></p>
                <div>
                    <input id='username' type="text" pat="[0-9A-Za-z_].{0,19}" placeholder="username or phone no." required>
                </div>
                <div>
                    <input id='password' type="password" pat="[0-9A-za-z@$_&]{0,19}" placeholder="password" required>
                </div>
                <div class="login-page-button">
                    <button type='submit'>
                        <span>LOGIN</span> </button>
                </div>
                <div class="forgot">
                    <a href="password" >Forgot password?</a>
                </div>
                <hr>
                
                </form>  
                <div class="create-button">
                    <button onclick='signUp()'>
                        <span>Create New Account</span> </button>
                </div> 
            </div>
            <div class="help-center">
                <div class='externallinks'>
                <p>Facebook : <a>my link</a> </p> 
                <p>Instagram : <a>my link</a></p>
                </div>
                <div class='copyright'>
                    <p>@ copyright owned by Bharath Gowda B - 5600 7932 1796  &emsp;
                   <a>.Terms and conditions</a><span>&emsp;.</span><a>Policies</a></p>    
                </div>
                <div class='contact'>
                    <p>Help-Center :</p>
                    <p>Contact : <a>9900783185</a></p>
                    <p>Email   : <a>bharathvishnubharath@gmail.com</a></p>  
                </div>
                
            </div>
                
        </div>
        <script>
        async function signUp(){
                window.sessionStorage.setItem("password",'');
                window.open('/home/signUp','_self');
        }

        document.getElementById('main-form').addEventListener('submit',function(e){
                e.preventDefault();
                login();
        })
        document.getElementById('username').addEventListener('change',function(e){
            document.getElementById('authenticationError').innerHTML = '';
        })
        async function login(){ 
            console.log('login request');
            var username = document.getElementById('username').value;
            var password = document.getElementById('password').value;

            var user = {'username': username, 'password': password}
                
            var res = await axios.post('/home/login',user);
            var data = res.data;
            console.log(data);
            if(!data.error){
                window.sessionStorage.setItem("token",data.token);
                window.sessionStorage.setItem("username",username);
                console.log("Logged Successfully");
                //window.sessionStorage.setItem('password','');
                window.open('/user','_self');  
            }
            else{
                var p = document.getElementById('authenticationError');
                p.innerText = data.type;
                document.getElementById('password').value = '';
            }

        }  
        </script>
    </body>
</html>