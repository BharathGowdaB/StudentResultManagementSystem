<html>
    <head>
        <title>
            BIT-Result Portal
        </title>
        <script src='./static/JS/axios.min.js'></script>
        <link rel="stylesheet" href='./static/CSS/navBar.css'>
        <link rel="stylesheet" href='./static/CSS/faculty-home.css'>
        <link rel="stylesheet" href='./static/CSS/table.css'>
    </head>
    <style>
        #root{
            min-height: 100vh;
        }
        .table-list th{
            min-width: 80px;
        }
       
    </style>
    <body>
        <nav class="navbar">
            <div class='nav-left'>
                <div class='app-logo'><img src='./static/images/logo.png' class="medium-icon"></div>
                <div class='app-name'> Bangalore Institute Of Technology </div>
            </div>
            <div class='nav-right'>
                <ul>
                    <li class='active' id='main-options-home'><a>Home</a></li>
                    <li id='main-options-professors'><a >Professors</a></li>
                    <li id='main-options-results'><a >Results</a></li>
                    <li class='nav-userinfo'>
                        <label class="nav-userpic" for='upload-pic'>
                            <img id='user-icon'   src='static/icons/thumnail.png'>
                        </label>
                        <input type='file' id='upload-pic' accept="image/*" style="display: none;">
                        <div class='nav-username' id='username'></div>
                    </li>
                </ul>
            </div>   
        </nav>
        <div id='home-render' style='min-height: 100vh;'>

        </div>
        <div id='root' style='display: none;'>  
            <style>
                .hod-panel{
                    display: flex;
                    background-color: white;
                    padding: 15px 0px;
                    border-radius: 4px;
                    box-shadow: 2px 2px 5px gray;
                    width: 80%;
                    margin: auto;
                    justify-content: space-between;
                    font-size: 20px;
                }
                
            </style>
            <div class='hod-panel' id='professors-hod-pannel' style='display: none;' >
                <div id='hod-name' style='padding-left:15px;min-width:15%'></div>
                <div id='dept-name'></div>
                <div id='hod-contact' style='padding-right:15px;width:15%'></div>
            </div> 
            <style>
                .header-option2{
                    width:80%;
                    margin: auto;
                }
                .semester-option{
                    display: flex;
                    justify-content: end; 
                    background-color: white;
                    width: fit-content;
                    border-radius: 4px;
                    box-shadow: 2px 2px 8px -1px rgb(100, 100, 100);
                    align-items: center;
                }
                .semester-option:nth-child(1){
                    display: flex;
                }
                .drop-down-options{
                    min-width: 60px;
                    padding: 0px 10px;
                    border: none;
                    background-color: transparent;
                    outline: none;
                }
                .drop-down-options option{
                    border: none;
                }
    
                .add-student-button{
                    margin: 4px 4px 4px 10px;
                    
                    padding: 10px 10px;
                    display: flex;
                    justify-content:space-evenly;
                    border-radius:4px;
                    align-items: center;
                    border: 1px solid purple;
                }
            </style>
            <div class='header-option2' id='results-header-options' style="display:none;width: 100%;">
                <div class='semester-option'><div style='padding-left: 10px;'>Semester</div>
                        <select class="drop-down-options" name="semester" id="id-semester">
                            
                        </select>
                        <div class='add-student-button' onclick="curInfo.semester = document.getElementById('id-semester').value;renderResult()" >
                            <span style='color:purple;font-weight: bold;'>Get Result</span>
                        </div>
                </div>
            
        </div>
            <div id='main-table'>

            </div>
        </div>
        <div >
            <img style="margin:auto;width:100%;height:100vh;object-fit: cover;" src='./static/images/background1.jpg'>
        </div>
    </body>   
        <script src='static/JS/index.js'></script>
        <script>
            async function renderHome(){
                let root = document.getElementById('home-render')
                let div = document.createElement('div');
                div.className = 'home-descp'
                div.innerHTML = `<h2>WELCOME TO BANGALORE INSTITUTE OF TECHNOLOGY</h2>
                <p>Bangalore Institute of Technology (BIT) was started in the year 1979 with the objective of providing 
                    quality education in the ﬁeld of Technology and thereby serving the society. It has reached enviable level 
                    of excellence in technical education. This was achieved due to the unconditional support of Rajya Vokkaligara
                     Sangha, committed staff and students. The environment of BIT motivates the student to quench their thirst for
                      knowledge. The college thrives to achieve the all-round development of the students.
                </p>
                <p>BIT has always been at the forefront of modern technology and has the distinction of being the ﬁrst College to introduce 
                    a full-ﬂedged degree in Computer Science and Engineering in Karnataka. The institute has visualized the areas of future growth
                    and incorporated various courses over the years. At present BIT has 10 undergraduate, 10 post graduate and 13 research centers.
                    BIT has an annual intake of 1300 students. There are a number of centers carrying out inter-disciplinary research and many 
                    collaborative programs exist between the college and other professional institutions, like IISc, NAL.
                    The Chemistry department has been recognized as one of the latest research centers in Karnataka. BIT also has the acclaim of 
                    being the Study center for IGNOU programmes.
                </p>
                <p>BIT is proud to say that it has 289 faculty members with excellent knowledge and teaching caliber. 83 faculty members have 
                    PhD degree and 71 are pursuing PhD. Sixty percent of faculty members have served BIT for more than twenty years. 
                    The Institution has 294 efficient and committed team of supporting staff.
                </p>`  
                root.innerHTML = ''
                root.append(div)
            }
          
        </script>
        <script src="./static/JS/faculty-student.js"></script>
        <script>
            const professorsList = {metaData:{},rows:[]}
            const resultList = {metaData:{},rows:[]}
            const curInfo = {}

            async function getProfessorsList(){
                var user = {
                    'username' : sessionStorage.getItem('username'),
                    'token' : sessionStorage.getItem('token'),
                }
                var res = await axios.post('/student/professors',user)
                console.log(res.data)
                if(res.data.error){
                    alert('No Professors found')
                }
                else{
                    for(let i=0; i < res.data.metaData.length ; i++)
                    {
                        professorsList.metaData[res.data.metaData[i].name] = i;
                    }
                    professorsList.rows = res.data.rows
                      
                }
            }

            async function createTableValue(info,alist,rlist,rootEle){
                rootEle.innerHTML = ''
                console.log(rlist)
                var colPos = []
                var priColPos  = rlist.metaData[info.primary_col]
    
                var table = document.createElement('tbody')
                let headerSize = info.headerSize

                let tr = document.createElement('tr')
                let tr2 =  document.createElement('tr')
                let j=0;
                for(let i=0; i < alist.length; i++)
                {
                    let th = document.createElement('th')

                    th.colSpan = alist[i][1].colSpan
                    th.rowSpan = alist[i][1].rowSpan    
                    th.innerHTML = alist[i][1].name
                    th.id = alist[i][1].name.toUpperCase()

                    if(alist[i][1].colSpan > 1){
                        count = 0;
                        totalColSpan = alist[i][1].colSpan
                        idHeader = alist[i][1].name.toUpperCase()
            
                        while(totalColSpan > count)
                        {
                            count++
                            let th2 = document.createElement('th')
                
                            th2.id = idHeader + ':' + alist[i+count][1].name.toUpperCase()
                            th2.innerHTML = alist[i+count][1].name
                            colPos.push(rlist.metaData[alist[i+count][0]])
                            tr2.append(th2)
                        }
                        alist.splice(i,1)
                        j++
                        i = i+count
                        i--
                    }
                    else{
            
                        colPos.push(rlist.metaData[alist[i][0]])
                    }
       
                    tr.append(th)
        
                }
    
                table.append(tr)
                if(tr2.childNodes.length > 0){
                    table.append(tr2)
                }
   
                for(let i=0 ; i<rlist.rows.length;i++){
                    let tr = document.createElement('tr')
                    tr.id = rlist.rows[i][priColPos]
                    for(let j=0 ; j<colPos.length; j++){
                        let td = document.createElement('td')
                        let div = document.createElement('div')
                        if(alist[j][2].tagType == 'img'){
                            let img = document.createElement('img')
                            img.src = '/home/get-user-pic/'+userInfo.username+'&'+userInfo.token+'&'+ rlist.rows[i][colPos[j]]
                            img.style.width = '60px';
                            img.style.borderRadius = '50px';
                            div.append(img)
                        }   
                        else{
                            let colValue = rlist.rows[i][colPos[j]]
                            if(colValue < -1){
                                colValue = ''
                            }
                            else if(colValue == -1){
                                colValue = 'AB'
                                div.style.color =  'rgb(168, 32, 14)'
                            }
                            else if(alist[j][1].isSlNo)
                                colValue = i+1
                        
                            div.innerHTML = colValue
                        }
                        td.append(div)
                        tr.append(td)
                    }
                    table.append(tr)
                }

                tableEle = document.createElement('table')
                tableEle.className = 'table-list'
                tableEle.append(table)
                rootEle.append(tableEle)
 
            } 
   
        </script>
        <script>
            
            async function renderHOD(){
                document.getElementById('hod-name').innerHTML = userInfo.hod
                document.getElementById('hod-contact').innerHTML = userInfo.hod_contact
                document.getElementById('dept-name').innerHTML = 'HOD : ' + userInfo.dept_name
            }
            async function renderProfessors(){
                renderHOD()
                document.getElementById('main-table').innerHTML = ''
                await getProfessorsList()    
                if(professorsList.rows.length < 1)
                {
                    alter('No Professors Found')
                }
                let colList = [
                        ['SLNO',{name:'SlNo',colSpan:1,rowSpan:1,isSlNo:true,isOptional:true},{tagType:'div'}],
                        ['PHOTO_CONTAINER',{name:'Photo',colSpan:1,rowSpan:1,isOptional:true},{tagType:'img'}],
                        ['NAME',{name:'Name',colSpan:1,rowSpan:1},{tagType:'div'}],
                        ['COURSE_ID',{name:'Course',colSpan:1,rowSpan:1},{tagType:'div'}],
                        ['TITLE',{name:'Title',colSpan:1,rowSpan:1},{tagType:'div'}],
                        ['CONTACT',{name:'Contact',colSpan:1,rowSpan:1},{tagType:'div'}]
                    ]


                    let table = document.getElementById('main-table')
                    createTableValue({ primary_col : 'USN',headerSize:1},colList,professorsList,table)
                   
            }
          
        </script>
         <script>
             async function getResultList(){
                var user = {
                    'username' : sessionStorage.getItem('username'),
                    'token' : sessionStorage.getItem('token'),
                    'semester' : curInfo.semester
                }
                var res = await axios.post('/student/results',user)
                console.log(res.data)
                if(res.data.error){
                    alert('No results found')
                    resultList.rows = []
                }
                else{
                    for(let i=0; i < res.data.metaData.length ; i++)
                    {
                        resultList.metaData[res.data.metaData[i].name] = i;
                    }
                    resultList.rows = res.data.rows
                    
                }
            }

            async function renderResult(){
                document.getElementById('main-table').innerHTML = ''
                await getResultList()    
                if(resultList.rows.length < 1)
                {
                    //alert('No results found')
                   
                }
                else{
                let colList = [
                        ['COURSE_ID',{name:'Course',colSpan:1,rowSpan:2},{tagType:'div'}],
                        ['TITLE',{name:'Title',colSpan:1,rowSpan:2},{tagType:'div'}],

                        ['TEST1_MARKS',{name:'Internals-1',colSpan:2,rowSpan:1},{tagType:'div'}],
                        ['TEST1_MARKS',{name:'Test',colSpan:1,rowSpan:1},{tagType:'input'}],
                        ['TEST1_ASSIGNMENT',{name:'Assignment',colSpan:1,rowSpan:1},{tagType:'div'}],
                        
                        ['TEST2_MARKS',{name:'Internals-2',colSpan:2,rowSpan:1},{tagType:'div'}],
                        ['TEST2_MARKS',{name:'Test',colSpan:1,rowSpan:1},{tagType:'div'}],
                        ['TEST2_ASSIGNMENT',{name:'Assignment',colSpan:1,rowSpan:1},{tagType:'div'}],
                        
                        ['TEST3_MARKS',{name:'Internals-2',colSpan:2,rowSpan:1},{tagType:'div'}],
                        ['TEST3_MARKS',{name:'Test',colSpan:1,rowSpan:1},{tagType:'div'}],
                        ['TEST3_ASSIGNMENT',{name:'Assignment',colSpan:1,rowSpan:1},{tagType:'div'}],
                        
                        ['IA_MARKS',{name:'Final-IA',colSpan:1,rowSpan:2},{tagType:'div'}],
                        ['EXTERNAL_MARKS',{name:'Externals',colSpan:1,rowSpan:2},{tagType:'div'}],
                        ['TOTAL',{name:'Total',colSpan:1,rowSpan:2},{tagType:'div'}]

                    ]


                    let table = document.getElementById('main-table')
                    createTableValue({ primary_col : 'USN',headerSize:1},colList,resultList,table)
                }
            }
          
        </script>
        <script>
            async function setInActive(){
                document.getElementById('root').style.display = 'none'
                document.getElementById('home-render').style.display = 'none'
                document.getElementById('main-options-home').className = ''
                document.getElementById('main-options-professors').className = ''
                document.getElementById('main-options-results').className = ''
                document.getElementById('professors-hod-pannel').style.display = 'none'
                document.getElementById('results-header-options').style.display = 'none'
            }

            document.getElementById('main-options-home').childNodes[0].onclick = async function(e){
                e.preventDefault()
                setInActive()
                e.target.parentNode.className = 'active'
                renderHome()
                document.getElementById('home-render').style.display = 'block'
                window.history.replaceState({student: 'student'},'','home')
            }
            document.getElementById('main-options-professors').childNodes[0].onclick = async function(e){
                e.preventDefault()
                setInActive()
                e.target.parentNode.className = 'active'
                renderProfessors()
                document.getElementById('root').style.display = 'block'
                document.getElementById('professors-hod-pannel').style.display = 'flex'
                window.history.replaceState({student: 'student'},'','professors')
            }
            document.getElementById('main-options-results').childNodes[0].onclick = async function(e){
                e.preventDefault()
                setInActive()
                e.target.parentNode.className = 'active'

                curInfo.semester = userInfo.semester
                dropdown = document.getElementById('id-semester')
                dropdown.innerHTML = ''
                for(i=0;i<curInfo.semester;i++)
                {
                    opt = document.createElement('option')
                    opt.value= i+1
                    opt.innerHTML= i+1
                    dropdown.append(opt)
                }
                dropdown.value = curInfo.semester
                renderResult()
                document.getElementById('root').style.display = 'block'
                document.getElementById('results-header-options').style.display = 'block'
                window.history.replaceState({student: 'student'},'','results')
               
            }
        </script>
        <script>
            const userInfo = {}
            async function authenticate(){
                var user={
                    'username': sessionStorage.getItem('username'),
                    'token' : sessionStorage.getItem('token')
                }
                let res = await axios.post('/student/authenticate',user)
                if(res.data.error){
                    console.log('Authentication error')
                    alert('Authentication Failed')
                    document.body.innerHTML = ''
                    window.open('/','_self')
                }
                else{
                    console.log(res.data)
                    userInfo['username'] = user.username
                    userInfo['token'] = user.token
                    userInfo['name'] = res.data.name
                    userInfo['photo_container'] = res.data.photo_container
                    userInfo['contact'] = res.data.contact
                    userInfo['semester'] = res.data.semester
                    userInfo['hod'] = res.data.hod
                    userInfo['hod_contact'] = res.data.hod_contact
                    userInfo['dept_name'] = res.data.dept_name
                    document.getElementById('username').innerHTML = userInfo.name
                    if(userInfo.photo_container != null)
                        setProfilePic()
                    pageRender()  
                }
            }

            async function pageRender(){
                console.log(window.location.pathname)
                if(window.location.pathname == '/student/professors'){
                    document.getElementById('main-options-professors').childNodes[0].click()
                }
                   
                else if(window.location.pathname == '/student/results'){
                    document.getElementById('main-options-results').childNodes[0].click()
                }    
                else{
                    document.getElementById('main-options-home').childNodes[0].click()
                }
                   
            }
            authenticate()
        </script>
    
</html>